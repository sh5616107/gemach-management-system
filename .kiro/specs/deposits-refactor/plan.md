# ⚠️ קובץ זה מיושן - ראה את הקבצים החדשים

**הערה**: תוכנית זו הומרה ל-spec מסודר עם:
- `requirements.md` - דרישות מפורטות
- `design.md` - עיצוב מפורט
- `tasks.md` - רשימת משימות (הושלמו כולן ✅)
- `IMPLEMENTATION_SUMMARY.md` - סיכום היישום

---

# תוכנית: שינוי מבנה הפקדות - מפקיד עם מספר הפקדות

## מטרה
לאפשר למפקיד אחד להיות לו מספר הפקדות נפרדות, כל אחת עם תאריך וסכום משלה, ולעקוב אחרי משיכות בצורה מדויקת יותר.

## הבעיה הנוכחית
- מפקיד = הפקדה אחת
- אם מפקיד מוסיף כסף, צריך לשנות את הסכום הקיים
- אין היסטוריה של הפקדות
- קשה לעקוב אחרי תאריכים ומשיכות

## הפתרון המוצע

### מבנה נתונים חדש

**Depositor (מפקיד):**
```typescript
interface Depositor {
  id: number
  name: string
  idNumber: string
  phone: string
  notes: string
  // פרטי בנק (לעתיד - למס"ב)
  bankCode?: string
  branchNumber?: string
  accountNumber?: string
}
```

**Deposit (הפקדה):**
```typescript
interface Deposit {
  id: number
  depositorId: number  // קישור למפקיד
  amount: number
  depositDate: string
  depositPeriod: number
  reminderDays?: number
  status: 'active' | 'withdrawn'
  depositPaymentMethod?: string
  depositPaymentDetails?: string
  notes?: string
}
```

**Withdrawal (משיכה):**
```typescript
interface Withdrawal {
  id: number
  depositId: number  // קישור להפקדה ספציפית
  amount: number
  date: string
  paymentMethod?: string
  paymentDetails?: string
  notes?: string
}
```

### שלבי המעבר

#### שלב 1: יצירת מבנה נתונים חדש
1. הוסף טבלת `depositors` (מפקידים)
2. שנה את `deposits` לכלול `depositorId`
3. `withdrawals` כבר קיים ומקושר ל-`depositId`

#### שלב 2: המרת נתונים קיימים
1. עבור כל הפקדה קיימת:
   - צור מפקיד חדש
   - קשר את ההפקדה למפקיד
   - העבר משיכות להפקדה

#### שלב 3: עדכון ממשק משתמש

**דף הפקדות:**
- רשימת מפקידים (במקום רשימת הפקדות)
- לחיצה על מפקיד -> הצגת כל ההפקדות שלו
- כפתור "הפקדה חדשה" למפקיד קיים
- כפתור "מפקיד חדש"

**כרטיס מפקיד:**
```
┌─────────────────────────────────────┐
│ 👤 ישראל ישראלי                    │
│ 📞 050-1234567                      │
│ 💰 סה"כ בגמ"ח: ₪5,000              │
│                                     │
│ הפקדות:                             │
│ ├─ 01/01/2024: ₪3,000 (פעילה)     │
│ ├─ 15/03/2024: ₪2,000 (פעילה)     │
│ └─ 20/05/2024: ₪1,000 (נמשכה)     │
│                                     │
│ [➕ הפקדה חדשה] [✏️ ערוך] [🗑️ מחק] │
└─────────────────────────────────────┘
```

#### שלב 4: פונקציות חדשות

**במסד נתונים:**
- `addDepositor()` - הוסף מפקיד
- `updateDepositor()` - עדכן מפקיד
- `deleteDepositor()` - מחק מפקיד (רק אם אין הפקדות פעילות)
- `getDepositorDeposits()` - קבל כל הפקדות של מפקיד
- `getDepositorBalance()` - חשב יתרה כוללת של מפקיד
- `addDepositToDepositor()` - הוסף הפקדה למפקיד קיים

#### שלב 5: תאימות לאחור
- שמור תמיכה בנתונים ישנים
- המרה אוטומטית בטעינה ראשונה
- הודעה למשתמש על המעבר

## יתרונות

1. ✅ **היסטוריה מלאה** - כל הפקדה נשמרת בנפרד
2. ✅ **עקיבה טובה יותר** - תאריכים ומשיכות מדויקים
3. ✅ **גמישות** - מפקיד יכול להוסיף כסף בכל עת
4. ✅ **דוחות מדויקים** - ניתן לראות מתי הופקד כל סכום
5. ✅ **תזכורות** - תזכורת לכל הפקדה בנפרד
6. ✅ **הכנה למס"ב** - פרטי בנק ברמת המפקיד

## סיכונים

1. ⚠️ **שינוי מבנה** - צריך להמיר נתונים קיימים
2. ⚠️ **תאימות** - לוודא שהכל עובד אחרי המעבר
3. ⚠️ **למידה** - משתמשים צריכים להתרגל למבנה החדש

## זמן משוער

- שלב 1: 1 שעה
- שלב 2: 1 שעה
- שלב 3: 3 שעות
- שלב 4: 1 שעה
- שלב 5: 1 שעה

**סה"כ: ~7 שעות**

## האם להתחיל?

זה שינוי משמעותי שישפר מאוד את המערכת. האם תרצה שנתחיל?
