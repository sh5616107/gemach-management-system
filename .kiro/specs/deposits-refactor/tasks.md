# רשימת משימות - ניהול מפקידים והפקדות

## משימות יישום

- [x] 1. הוספת ממשקים ופונקציות בסיסיות למפקידים במסד הנתונים


  - צור ממשק `Depositor` עם כל השדות הנדרשים (id, name, idNumber, phone, notes, bankCode, branchNumber, accountNumber)
  - הוסף מערך `depositors: Depositor[]` ל-`DatabaseFile`
  - הוסף טעינה ושמירה של `gemach_depositors` ב-`localStorage` בפונקציות `loadData()` ו-`saveData()`
  - _דרישות: 1.1, 1.2_

- [x] 2. יישום פונקציות CRUD למפקידים


  - _דרישות: 1.1, 1.2, 1.3, 1.4_

- [x] 2.1 יישום `addDepositor()`


  - בדיקת תקינות מספר זהות (אם חובה בהגדרות)
  - בדיקת כפילות מספר זהות
  - ניקוי מספר זהות (הסרת רווחים ומקפים)
  - יצירת מפקיד חדש עם ID אוטומטי
  - החזרת מפקיד או אובייקט שגיאה
  - _דרישות: 1.1_

- [x] 2.2 יישום `getDepositors()` ו-`getDepositorById()`

  - פונקציה להחזרת כל המפקידים
  - פונקציה לחיפוש מפקיד לפי ID
  - _דרישות: 1.5_

- [x] 2.3 יישום `updateDepositor()`

  - בדיקת קיום מפקיד
  - ולידציה של שדות מעודכנים (במיוחד מספר זהות)
  - בדיקת כפילות מספר זהות (למעט המפקיד הנוכחי)
  - עדכון ושמירה
  - _דרישות: 1.2_

- [x] 2.4 יישום `deleteDepositor()`

  - בדיקה שאין הפקדות פעילות למפקיד
  - מחיקת מפקיד והיסטוריה אם אין הפקדות פעילות
  - החזרת הצלחה או שגיאה מתאימה
  - _דרישות: 1.3, 1.4_

- [x] 3. יישום פונקציות עזר למפקידים


  - _דרישות: 2.5, 5.1, 5.2_

- [x] 3.1 יישום `getDepositorBalance()`


  - חישוב סכום כל ההפקדות הפעילות של מפקיד
  - הפחתת כל המשיכות
  - החזרת יתרה נוכחית
  - _דרישות: 5.1_

- [x] 3.2 יישום `getDepositorDeposits()`

  - קבלת כל ההפקדות של מפקיד ספציפי
  - מיון לפי תאריך הפקדה
  - _דרישות: 2.3_

- [x] 3.3 יישום `getDepositorActiveDepositsCount()`

  - ספירת הפקדות פעילות של מפקיד
  - _דרישות: 5.2_

- [x] 4. עדכון ממשק `Deposit` והוספת שדה `depositorId`

  - הוסף שדה `depositorId: number` לממשק `DatabaseDeposit`
  - שמור שדות ישנים לתאימות לאחור (depositorName, idNumber, phone)
  - עדכן תיעוד הממשק
  - _דרישות: 2.1, 2.2_

- [x] 5. עדכון פונקציות הפקדות קיימות


  - _דרישות: 2.1, 2.2, 2.4_

- [x] 5.1 יישום `addDepositToDepositor()`


  - פונקציה חדשה להוספת הפקדה למפקיד קיים
  - בדיקת קיום מפקיד
  - יצירת הפקדה עם קישור ל-`depositorId`
  - מילוי שדות ישנים לתאימות לאחור
  - _דרישות: 2.1_

- [x] 5.2 עדכון `addDeposit()` לתמיכה במבנה החדש

  - שמירת תמיכה במבנה הישן (ליצירה ישירה)
  - הוספת אפשרות ליצירה עם `depositorId`
  - _דרישות: 2.2_

- [x] 5.3 עדכון `getDeposits()` לכלול מידע על מפקיד

  - החזרת הפקדות עם פרטי מפקיד (אם קיים)
  - תמיכה בהפקדות ישנות ללא מפקיד
  - _דרישות: 2.3_

- [x] 6. יישום לוגיקת המרת נתונים
  - _דרישות: 4.1, 4.2, 4.3, 4.4, 4.5_

- [x] 6.1 יישום `migrateDepositsToDepositors()`


  - בדיקה אם כבר בוצעה המרה (דגל ב-localStorage)
  - מעבר על כל ההפקדות הקיימות
  - יצירת מפקיד חדש לכל הפקדה (או מיזוג אם מספר זהות זהה)
  - עדכון הפקדות עם `depositorId`
  - שמירת דגל המרה
  - _דרישות: 4.1, 4.2, 4.3_

- [x] 6.2 טיפול בכפילויות במהלך המרה

  - זיהוי מפקידים כפולים לפי מספר זהות
  - מיזוג הפקדות לאותו מפקיד
  - יצירת מפקידים נפרדים אם אין מספר זהות
  - _דרישות: 4.2_

- [x] 6.3 הצגת הודעת המרה למשתמש

  - יצירת הודעה עם מספר מפקידים שנוצרו
  - הצגת מספר הפקדות שעודכנו
  - שמירת לוג המרה
  - _דרישות: 4.4_

- [x] 7. עדכון ממשק משתמש - תצוגת רשימת מפקידים


  - _דרישות: 6.1, 6.2_


- [x] 7.1 יצירת קומפוננטת `DepositorCard`

  - הצגת שם מפקיד, טלפון, יתרה, מספר הפקדות
  - כפתורים: צפה, ערוך, מחק
  - עיצוב כרטיס נקי וברור
  - _דרישות: 6.6_

- [x] 7.2 עדכון `DepositsPage` להצגת רשימת מפקידים

  - החלפת תצוגת הפקדות ברשימת מפקידים
  - כפתור "מפקיד חדש" בראש העמוד
  - רשימה של כרטיסי מפקידים
  - _דרישות: 6.1_


- [x] 7.3 הוספת חיפוש וסינון מפקידים
  - שדה חיפוש לפי שם או מספר זהות
  - סינון לפי סטטוס (פעיל/נמשך)
  - מיון לפי שם, יתרה, תאריך
  - _דרישות: 6.1_

- [x] 8. עדכון ממשק משתמש - תצוגת מפקיד והפקדות
  - _דרישות: 6.2, 6.3_

- [x] 8.1 יצירת תצוגת פרטי מפקיד
  - הצגת כל פרטי המפקיד (שם, ת.ז., טלפון, הערות)
  - הצגת יתרה כוללת
  - כפתורים: הפקדה חדשה, ערוך פרטים, חזרה
  - _דרישות: 6.2, 6.6_

- [x] 8.2 יצירת רשימת הפקדות למפקיד
  - הצגת כל הפקדות המפקיד
  - כל הפקדה: תאריך, סכום, יתרה, סטטוס, תקופה
  - כפתורים לכל הפקדה: משיכה, שטר, ערוך
  - מיון לפי תאריך (חדשות בראש)
  - _דרישות: 2.3, 6.2_



- [x] 8.3 הוספת ניווט בין תצוגות

  - לחיצה על מפקיד ברשימה -> מעבר לתצוגת מפקיד
  - כפתור חזרה -> חזרה לרשימת מפקידים
  - שמירת מצב בניווט (history)
  - _דרישות: 6.2_

- [x] 9. עדכון ממשק משתמש - טפסים

  - _דרישות: 6.3, 6.4, 6.5_

- [x] 9.1 יצירת טופס מפקיד חדש
  - שדות: שם מלא, מספר זהות, טלפון, הערות
  - שדות הפקדה ראשונה: סכום, תאריך, תקופה, ימי תזכורת, אמצעי תשלום
  - שדות בנק אופציונליים: קוד בנק, סניף, חשבון
  - ולידציה של כל השדות
  - _דרישות: 6.4, 7.1, 7.2, 7.3, 7.4_

- [x] 9.2 יצירת טופס הפקדה חדשה למפקיד קיים
  - הצגת שם המפקיד בכותרת
  - שדות: סכום, תאריך, תקופה, ימי תזכורת, אמצעי תשלום, הערות
  - ולידציה
  - _דרישות: 6.3, 2.1_

- [x] 9.3 עדכון טופס עריכת מפקיד
  - טופס לעריכת פרטים אישיים בלבד
  - אין אפשרות לערוך הפקדות מכאן
  - ולידציה של שינויים
  - _דרישות: 6.5_

- [x] 10. עדכון פונקציות קיימות לתמיכה במבנה החדש
  - _דרישות: 3.1, 3.2, 3.3, 3.4, 3.5_

- [x] 10.1 עדכון `withdrawDeposit()` לעבוד עם המבנה החדש
  - וידוא שהמשיכה מקושרת להפקדה הנכונה
  - עדכון יתרת ההפקדה
  - עדכון סטטוס אם נמשך הכל
  - _דרישות: 3.1, 3.2, 3.3, 3.4_

- [x] 10.2 עדכון יצירת שטר הפקדה
  - שימוש בפרטי מפקיד מהטבלה החדשה
  - תמיכה בהפקדות ישנות
  - _דרישות: 2.4_

- [x] 10.3 עדכון דוחות והיסטוריה
  - דוח מפקידים עם יתרות
  - דוח הפקדות לפי מפקיד
  - היסטוריית משיכות לפי מפקיד
  - _דרישות: 5.3, 5.4, 3.5_

- [x] 11. הוספת פרטי בנק למפקידים (הכנה למס"ב)
  - _דרישות: 7.1, 7.2, 7.3, 7.4, 7.5_

- [x] 11.1 הוספת שדות בנק לטופס מפקיד
  - שדות: קוד בנק, מספר סניף, מספר חשבון
  - סימון כאופציונלי
  - _דרישות: 7.1_

- [x] 11.2 ולידציה של פרטי בנק
  - בדיקה שקוד בנק הוא 2 ספרות
  - בדיקה שמספר סניף הוא 3 ספרות
  - בדיקה שמספר חשבון הוא עד 9 ספרות
  - _דרישות: 7.2, 7.3, 7.4_

- [x] 11.3 הצגת פרטי בנק בכרטיס מפקיד
  - הצגה רק אם קיימים
  - פורמט ברור וקריא
  - _דרישות: 7.5_

- [x] 12. בדיקות ותיקונים
  - _דרישות: כל הדרישות_

- [x] 12.1 בדיקת זרימת יצירת מפקיד חדש
  - יצירה -> שמירה -> הצגה ברשימה
  - בדיקת ולידציה
  - בדיקת הודעות שגיאה

- [x] 12.2 בדיקת זרימת הוספת הפקדה למפקיד קיים
  - בחירת מפקיד -> הוספת הפקדה -> עדכון יתרה
  - בדיקת חישוב יתרה

- [x] 12.3 בדיקת זרימת משיכה
  - בחירת הפקדה -> משיכה -> עדכון יתרה -> עדכון סטטוס
  - בדיקת משיכה חלקית ומלאה

- [x] 12.4 בדיקת המרת נתונים
  - יצירת נתונים ישנים -> המרה -> אימות נתונים חדשים
  - בדיקת טיפול בכפילויות
  - בדיקת שמירת נתונים ישנים

- [x] 12.5 בדיקת תאימות לאחור
  - וידוא שהפקדות ישנות עדיין עובדות
  - בדיקת גישה לשדות ישנים
  - בדיקת דוחות עם נתונים מעורבים

- [x] 12.6 תיקון באגים ובעיות שנמצאו
  - תיקון שגיאות
  - שיפור ביצועים
  - שיפור חוויית משתמש

- [x] 13. תיעוד ומדריך משתמש
  - _דרישות: כל הדרישות_

- [x] 13.1 עדכון README עם התכונה החדשה
  - הסבר על מפקידים והפקדות
  - הסבר על המרת נתונים
  - צילומי מסך

- [x] 13.2 יצירת מדריך למשתמש
  - איך ליצור מפקיד חדש
  - איך להוסיף הפקדה
  - איך לבצע משיכה
  - איך לצפות בהיסטוריה

- [x] 13.3 תיעוד טכני למפתחים
  - מבנה הנתונים
  - API של הפונקציות
  - תהליך ההמרה
