# תוכנית: גביית הפקדות ותרומות דרך מס"ב

## מטרה
לאפשר למנהל הגמ"ח לגבות הפקדות ותרומות ישירות מחשבונות הבנק של המפקידים/תורמים באמצעות קבצי מס"ב, במקום לקבל מזומן או המחאות.

## רקע
כיום המערכת מאפשרת יצירת קבצי מס"ב רק לגביית החזרי הלוואות מלווים. אבל גם הפקדות ותרומות יכולות להיגבות דרך מס"ב אם יש למפקיד/תורם הרשאה לחיוב חשבון.

## שלבי הפיתוח

### שלב 1: הוספת פרטי בנק למבני נתונים

#### 1.1 עדכון DatabaseDeposit
הוספת שדות:
- `bankCode?: string` - קוד בנק (2 ספרות)
- `branchNumber?: string` - מספר סניף (3 ספרות)
- `accountNumber?: string` - מספר חשבון (9 ספרות)

#### 1.2 עדכון DatabaseDonation
הוספת שדות:
- `idNumber?: string` - מספר זהות (9 ספרות)
- `bankCode?: string` - קוד בנק (2 ספרות)
- `branchNumber?: string` - מספר סניף (3 ספרות)
- `accountNumber?: string` - מספר חשבון (9 ספרות)

**הערה:** השדות אופציונליים כי לא כל מפקיד/תורם ירצה לשלם דרך מס"ב.

### שלב 2: עדכון ממשקי הפקדות ותרומות

#### 2.1 דף הפקדות (DepositsPage.tsx)
- הוספת שדות פרטי בנק בטופס הוספת/עריכת הפקדה
- הצגת אינדיקטור אם יש פרטי בנק
- אפשרות לסמן "גביה דרך מס"ב"

#### 2.2 דף תרומות (DonationsPage.tsx)
- הוספת שדות פרטי בנק בטופס הוספת/עריכת תרומה
- הצגת אינדיקטור אם יש פרטי בנק
- אפשרות לסמן "גביה דרך מס"ב"

### שלב 3: יצירת דף גביית הפקדות/תרומות

#### 3.1 דף חדש: MasavDepositsPage.tsx
תהליך דומה ל-MasavFileGeneratorPage אבל עבור הפקדות:

**שלב 1: בחירת הפקדות**
- רשימת הפקדות פעילות שיש להן פרטי בנק
- אפשרות לבחור מספר הפקדות
- הצגת סכום כולל

**שלב 2: הגדרת סכומים**
- ברירת מחדל: סכום ההפקדה המלא
- אפשרות לשנות (למשל: גביה חלקית)

**שלב 3: הגדרות קובץ**
- בחירת תאריך חיוב
- סוג תנועה: חיוב (504) - גביה מהמפקיד

**שלב 4: סיכום ויצירת קובץ**
- הצגת סיכום
- יצירת קובץ מס"ב
- שמירת היסטוריה

#### 3.2 דף חדש: MasavDonationsPage.tsx
תהליך זהה אבל עבור תרומות.

### שלב 4: קישור לניווט

#### 4.1 הוספה לתפריט
- הוספת קישור "גביית הפקדות דרך מס"ב" בתפריט
- הוספת קישור "גביית תרומות דרך מס"ב" בתפריט

#### 4.2 קיצורי דרך
- כפתור בדף הפקדות: "צור קובץ מס"ב"
- כפתור בדף תרומות: "צור קובץ מס"ב"

### שלב 5: שיפורים נוספים

#### 5.1 קישור לתשלומים
- לאחר יצירת קובץ מס"ב, לשמור קישור בין הקובץ להפקדה/תרומה
- כאשר הקובץ מבוצע, לעדכן את סטטוס ההפקדה/תרומה

#### 5.2 ולידציות
- בדיקת תקינות פרטי בנק
- אזהרה אם חסרים פרטים
- בדיקת כפילויות

#### 5.3 דוחות
- דוח הפקדות/תרומות שנגבו דרך מס"ב
- דוח השוואה בין קבצים שנשלחו לתשלומים שהתקבלו

## סדר עדיפויות

1. **גבוה:** שלב 1 + שלב 2 (הוספת פרטי בנק)
2. **גבוה:** שלב 3.1 (גביית הפקדות)
3. **בינוני:** שלב 3.2 (גביית תרומות)
4. **בינוני:** שלב 4 (קישור לניווט)
5. **נמוך:** שלב 5 (שיפורים)

## הערות טכניות

- להשתמש בפונקציות הקיימות: `buildMasavFile`, `buildTransactionRecord`
- לשמור היסטוריה ב-`masavFiles` עם סוג: `deposits` או `donations`
- לוודא שכל הולידציות עובדות (פרטי בנק, סכומים, תאריכים)

## זמן משוער

- שלב 1: 30 דקות
- שלב 2: 1 שעה
- שלב 3: 2 שעות
- שלב 4: 30 דקות
- שלב 5: 1 שעה

**סה"כ: ~5 שעות**
