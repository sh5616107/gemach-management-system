# תוכנית מימוש - מערכת העברת הלוואות לערבים

## סקירה

תוכנית זו מפרטת את השלבים הנדרשים למימוש מערכת העברת הלוואות לערבים. כל משימה בנויה על הקודמות ומסתיימת בקוד מתפקד ומשולב.

## משימות

- [x] 1. הוספת מבני נתונים ומתודות Database



- [x] 1.1 הוסף interface DatabaseGuarantorDebt ל-database.ts


  - צור interface עם כל השדות: id, originalLoanId, guarantorId, originalBorrowerId, amount, transferDate, transferredBy, paymentType, installmentsCount, installmentAmount, installmentDates, status, notes
  - הוסף את guarantorDebts למבנה DatabaseFile
  - _דרישות: 2.1, 6.1, 6.2_

- [x] 1.2 עדכן interface DatabaseLoan עם שדות העברה


  - הוסף שדות: transferredToGuarantors, transferDate, transferredBy, transferNotes
  - _דרישות: 5.1, 5.2, 5.4_

- [x] 1.3 עדכן interface DatabasePayment לתמיכה בתשלומי ערבים


  - הוסף שדה guarantorDebtId
  - _דרישות: 6.4_

- [x] 1.4 הוסף מתודות בסיסיות ל-GemachDatabase


  - מימוש addGuarantorDebt() - יצירת חוב ערב חדש
  - מימוש getGuarantorDebts() - קבלת כל חובות הערבים
  - מימוש getGuarantorDebtsByGuarantorId() - חובות של ערב ספציפי
  - מימוש getGuarantorDebtsByLoanId() - חובות שנוצרו מהלוואה ספציפית
  - מימוש updateGuarantorDebtStatus() - עדכון סטטוס חוב
  - _דרישות: 6.1, 6.3, 6.4_

- [x] 1.5 מימוש מתודת transferLoanToGuarantors()


  - קבלת פרמטרים: loanId, guarantorSplits (Map<guarantorId, amount>), paymentType, installmentsData
  - יצירת רשומות GuarantorDebt לכל ערב
  - עדכון הלוואה עם שדות העברה
  - הוספת לווה לרשימה שחורה אוטומטית
  - החזרת תוצאה או שגיאה
  - _דרישות: 2.1, 2.2, 2.3, 5.1, 5.5, 6.1, 7.1, 7.2_



- [x] 2. יצירת דף הלוואות שפג תוקפן (OverdueLoansPage)





- [x] 2.1 צור קובץ OverdueLoansPage.tsx




  - צור קומפוננטה בסיסית עם header ו-banner תואמים לעיצוב הכללי
  - הוסף כפתור חזרה לדף הבית
  - הוסף כותרת "⏰ הלוואות שפג תוקפן"
  - _דרישות: 1.1, 1.5_

- [x] 2.2 מימוש לוגיקת זיהוי הלוואות שפג תוקפן



  - טען את כל ההלוואות מה-database
  - סנן הלוואות שתאריך הפירעון שלהן עבר
  - סנן הלוואות שלא סומנו כ-transferredToGuarantors
  - חשב יתרה לכל הלוואה (סכום - תשלומים)
  - סנן רק הלוואות עם יתרה חיובית
  - חשב ימי איחור לכל הלוואה
  - _דרישות: 1.2, 1.3_

- [x] 2.3 הצגת רשימת הלוואות שפג תוקפן



  - הצג טבלה/כרטיסים עם פרטי כל הלוואה
  - הצג: שם לווה, סכום הלוואה, יתרה, תאריך פירעון, ימי איחור
  - הצג שמות ערבים לכל הלוואה
  - הוסף כפתור "🔄 העבר לערבים" לכל הלוואה
  - עיצוב בצבע אדום (#e74c3c) להדגשת דחיפות
  - _דרישות: 1.3, 1.4_

- [x] 2.4 הוסף route ל-OverdueLoansPage ב-App.tsx




  - הוסף import של OverdueLoansPage
  - הוסף Route עם path="/overdue-loans"
  - _דרישות: 1.1_

- [x] 2.5 הוסף כרטיס ב-AdminToolsPage



  - צור כרטיס חדש "הלוואות שפג תוקפן"
  - עיצוב בצבע אדום תואם
  - אייקון ⏰
  - ניווט ל-/overdue-loans בלחיצה
  - _דרישות: 1.1_

- [x] 3. יצירת מודל העברה לערבים (LoanTransferModal)




- [x] 3.1 צור קובץ LoanTransferModal.tsx



  - צור קומפוננטה עם props: isOpen, onClose, loan, borrower, guarantors, onTransferComplete
  - מבנה מודל בסיסי עם overlay ותיבת דיאלוג
  - עיצוב תואם למודלים קיימים (BlacklistManager)
  - _דרישות: 2.1, 2.2_

- [x] 3.2 מימוש שלב בחירת ערבים


  - הצג רשימת ערבים של ההלוואה
  - אפשרות לבחור "ערב אחד" או "כל הערבים"
  - אם ערב אחד - dropdown לבחירת הערב
  - בדיקה אם ערב ברשימה שחורה והצגת אזהרה
  - כפתור "המשך" למעבר לשלב הבא
  - _דרישות: 2.2, 2.3, 2.4, 2.5_

- [x] 3.3 מימוש שלב חלוקת סכומים



  - חישוב אוטומטי של חלוקה שווה בין ערבים
  - הצגת סכום לכל ערב
  - אפשרות לעריכה ידנית של סכומים
  - ולידציה שסכום כולל שווה לסכום ההלוואה
  - הצגת שגיאה אם הסכומים לא תואמים
  - _דרישות: 3.1, 3.2, 3.3, 3.4, 3.5_

- [x] 3.4 מימוש שלב תנאי תשלום


  - בחירה בין "תשלום אחד" ו"תשלומים"
  - אם תשלום אחד: בחירת תאריך פירעון
  - אם תשלומים: הגדרת מספר תשלומים, חישוב סכום כל תשלום, בחירת תאריכי פירעון
  - ולידציה שתאריכים לא בעבר
  - הצגת תוכנית התשלומים
  - _דרישות: 4.1, 4.2, 4.3, 4.4, 4.5_

- [x] 3.5 מימוש שלב אישור סופי



  - הצגת סיכום מלא: לווה, סכום, ערבים וסכומים, תנאי תשלום
  - כפתור "אשר העברה"
  - כפתור "ביטול"
  - הצגת הודעת אישור לפני ביצוע
  - _דרישות: 10.1, 10.2, 10.3, 10.4_

- [x] 3.6 מימוש ביצוע ההעברה


  - קריאה ל-db.transferLoanToGuarantors() עם כל הפרמטרים
  - טיפול בשגיאות והצגת הודעות מתאימות
  - הצגת הודעת הצלחה עם פרטי ההעברה
  - סגירת המודל ורענון הדף
  - _דרישות: 2.1, 2.2, 10.5_


- [x] 3.7 אינטגרציה של LoanTransferModal ב-OverdueLoansPage

  - הוסף state למודל (isOpen, selectedLoan)
  - פתיחת מודל בלחיצה על "העבר לערבים"


  - העברת נתונים נכונים למודל
  - רענון רשימה לאחר העברה מוצלחת
  - _דרישות: 2.1, 2.2_

- [x] 4. הצגת חובות ערבים בדף הלוואות

- [x] 4.1 צור קומפוננטה GuarantorDebtCard



  - הצגת פרטי חוב ערב: סכום, לווה מקורי, תאריך העברה, סטטוס
  - עיצוב מובחן בצבע כתום (#f39c12)
  - אייקון 🤝
  - קישור להלוואה המקורית
  - הצגת תוכנית תשלומים אם קיימת
  - _דרישות: 6.2, 6.3, 6.5_

- [x] 4.2 אינטגרציה ב-LoansPage


  - טען חובות ערבים בנוסף להלוואות
  - הצג חובות ערבים בסקציה נפרדת או משולבת
  - אפשרות לסנן/מיין לפי סוג (הלוואה/חוב ערב)
  - _דרישות: 6.5_


- [ ] 4.3 מימוש רישום פרעון לחוב ערב
  - כפתור "רשום פרעון" בכרטיס חוב ערב
  - מודל לרישום פרעון (דומה לפרעון הלוואה)
  - יצירת payment עם guarantorDebtId
  - עדכון סטטוס חוב אם נפרע במלואה
  - _דרישות: 6.4_

- [x] 5. סימון הלוואות מועברות בדף הלווה

- [x] 5.1 עדכן תצוגת הלוואות ב-LoansPage

  - הוסף סטטוס "הועברה לערבים" להלוואות מועברות
  - עיצוב בצבע סגול (#9b59b6)
  - אייקון 🔄
  - הצגת תאריך העברה ושם מבצע
  - _דרישות: 5.1, 5.3, 5.5_


- [ ] 5.2 הוסף אפשרות לצפות בפרטי העברה
  - לחיצה על הלוואה מועברת פותחת מודל פרטים
  - הצגת: ערבים שחויבו, סכומים, תאריך, מבצע, הערות
  - קישורים לחובות הערבים
  - _דרישות: 5.4_

- [x] 6. ניהול רשימה שחורה אוטומטי
- [x] 6.1 מימוש הוספה אוטומטית של לווה לרשימה שחורה
  - בתוך transferLoanToGuarantors() קרא ל-addToBlacklist()
  - סיבה: "לא פרע הלוואה - הועבר לערבים"
  - שמור קישור להלוואה המקורית
  - _דרישות: 7.1, 7.2, 7.3, 7.4, 7.5_

- [x] 6.2 מימוש בדיקה תקופתית של חובות ערבים
  - צור פונקציה checkOverdueGuarantorDebts()
  - זהה חובות ערבים שעבר מועד הפירעון
  - החזר רשימת ערבים שצריכים להיכנס לרשימה שחורה
  - _דרישות: 8.1_

- [x] 6.3 מימוש הוספה אוטומטית של ערב לרשימה שחורה
  - צור פונקציה addOverdueGuarantorsToBlacklist()
  - עבור על חובות שפג תוקפם
  - הוסף ערבים לרשימה שחורה עם סיבה "לא פרע חוב כערב"
  - שמור קישור לחוב הערב
  - _דרישות: 8.1, 8.2, 8.3, 8.4, 8.5_

- [x] 6.4 אינטגרציה של בדיקות תקופתיות
  - קרא ל-checkOverdueGuarantorDebts() בטעינת דף הלוואות
  - הצג התראה אם יש ערבים שצריכים להיכנס לרשימה שחורה
  - אפשרות להוסיף אוטומטית או ידנית
  - _דרישות: 8.1, 8.5_

- [x] 7. דוחות ומעקב


- [x] 7.1 צור דוח הלוואות מועברות



  - דף/מודל חדש עם רשימת כל ההלוואות שהועברו
  - הצגת: לווה מקורי, ערבים, סכומים, תאריכים, סטטוס
  - סינון לפי תאריך, סטטוס, ערב
  - _דרישות: 9.1, 9.2, 9.5_

- [x] 7.2 צור דוח חובות ערבים


  - רשימת כל חובות הערבים
  - הצגת סטטוס תשלום (שולם/לא שולם/חלקי)
  - חישוב סך כל הסכומים
  - סינון ומיון
  - _דרישות: 9.2, 9.3, 9.4, 9.5_

- [x] 7.3 אינטגרציה בדף סטטיסטיקות


  - הוסף סקציה "הלוואות מועברות לערבים"
  - הצג: מספר הלוואות מועברות, סכום כולל, מספר ערבים מעורבים
  - גרפים ותרשימים
  - _דרישות: 9.4_

- [x] 7.4 הוסף אפשרות ייצוא דוחות


  - כפתור ייצוא ל-Excel/PDF
  - בחירת טווח תאריכים
  - בחירת שדות לייצוא
  - _דרישות: 9.5_

- [x] 8. בדיקות ותיקונים סופיים

- [x] 8.1 בדוק תהליך העברה מלא מקצה לקצה

  - צור הלוואה שפג תוקפה
  - העבר לערב אחד
  - ודא שהלווה נכנס לרשימה שחורה
  - ודא שנוצר חוב ערב
  - רשום פרעון לחוב
  - _דרישות: כל הדרישות_


- [ ] 8.2 בדוק תהליך העברה לכל הערבים
  - צור הלוואה עם 2 ערבים
  - העבר לכל הערבים עם חלוקה שווה
  - ודא שנוצרו 2 חובות ערבים
  - ודא חלוקה נכונה של סכומים
  - _דרישות: 2.5, 3.1, 3.2, 3.3_


- [ ] 8.3 בדוק תהליך העברה עם תשלומים
  - העבר הלוואה עם תוכנית תשלומים
  - ודא שתוכנית התשלומים נשמרה נכון
  - רשום פרעון חלקי
  - ודא עדכון סטטוס

  - _דרישות: 4.1, 4.2, 4.3, 4.4, 4.5_

- [ ] 8.4 בדוק חסימות רשימה שחורה
  - ודא שלא ניתן ליצור הלוואה ללווה חסום
  - ודא שלא ניתן לבחור ערב חסום

  - בדוק הודעות שגיאה
  - _דרישות: 7.5, 8.5_

- [ ] 8.5 תקן באגים ובעיות UI
  - בדוק responsive design
  - בדוק נגישות
  - תקן שגיאות קונסול
  - שפר הודעות למשתמש
  - _דרישות: כל הדרישות_

- [x] 9. תיעוד ומדריך משתמש

- [x] 9.1 כתוב הערות קוד מפורטות


  - הוסף JSDoc לכל הפונקציות
  - הסבר לוגיקה מורכבת
  - דוגמאות שימוש
  - _דרישות: כל הדרישות_


- [x] 9.2 צור מדריך משתמש

  - הסבר על דף הלוואות שפג תוקפן
  - הדרכה על תהליך העברה
  - דוגמאות לתרחישים
  - שאלות נפוצות
  - _דרישות: כל הדרישות_
